@using BookLoggerApp.Core.ViewModels
@inject UserProgressViewModel ViewModel
@inject NavigationManager Navigation

<div class="user-progress-widget" @onclick="NavigateToLevelOverview">
    <div class="progress-header">
        <span class="level-icon">üèÜ</span>
        <span class="level-text">Level @ViewModel.CurrentLevel</span>
    </div>

    <div class="progress-bar-container">
        <div class="progress-bar">
            <div class="progress-fill" style="width: @ViewModel.ProgressPercentage.ToString("F1", System.Globalization.CultureInfo.InvariantCulture)%"></div>
        </div>
        <span class="progress-text">@ViewModel.CurrentLevelXp / @ViewModel.NextLevelXp XP</span>
    </div>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        await ViewModel.LoadCommand.ExecuteAsync(null);
    }

    private void NavigateToLevelOverview()
    {
        Navigation.NavigateTo("/level-overview");
    }

    /// <summary>
    /// Public method to refresh the widget (call after XP is earned).
    /// </summary>
    public async Task RefreshAsync()
    {
        await ViewModel.RefreshCommand.ExecuteAsync(null);
        StateHasChanged();
    }
}
