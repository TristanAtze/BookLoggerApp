<div class="book-card" @onclick="HandleClick">
    <div class="book-cover-wrapper" style="@GetSpineStyle()">
        <div class="book-status-badge status-@Book.Status.ToString().ToLower()">
            @GetStatusIcon()
        </div>
    </div>
    <div class="book-card-body">
        <h3 class="book-title">@Book.Title</h3>
        <p class="book-author">@Book.Author</p>
        @if (Book.Rating.HasValue)
        {
            <div class="book-rating">
                @for (int i = 1; i <= 5; i++)
                {
                    <span class="star @(i <= Book.Rating.Value ? "filled" : "empty")">‚òÖ</span>
                }
            </div>
        }
    </div>
    @if (Book.Status == BookLoggerApp.Core.Models.ReadingStatus.Reading || Book.Status == BookLoggerApp.Core.Models.ReadingStatus.Completed)
    {
        <div class="book-progress">
            <div class="progress-bar">
                <div class="progress-fill" style="width: @Book.ProgressPercentage%"></div>
            </div>
        </div>
    }
    <div class="book-card-actions">
        <button class="btn-icon" @onclick:stopPropagation="true" @onclick="HandleDelete" title="Delete">
            üóëÔ∏è
        </button>
    </div>
</div>

@code {
    [Parameter] public BookLoggerApp.Core.Models.Book Book { get; set; } = null!;
    [Parameter] public EventCallback OnClick { get; set; }
    [Parameter] public EventCallback OnDelete { get; set; }
    [Parameter] public EventCallback OnQuickTimer { get; set; }

    private string GetSpineStyle()
    {
        // Generate consistent color based on book ID
        var hash = Book.Id.GetHashCode();
        var colors = new[]
        {
            ("8B4513", "A0522D"), // Red-brown
            ("2C4A6B", "3A5F7D"), // Blue
            ("3D5A3D", "4A6B4A"), // Green
            ("5D4E6D", "6F5F7F"), // Purple
            ("4A3426", "5C452F"), // Brown
            ("8B7355", "A68968"), // Gold
            ("6B3240", "7D4450"), // Burgundy
            ("2C5F5F", "3A7373"), // Teal
            ("1C2E4A", "2A3F5F"), // Navy
            ("4A4A2C", "5C5C3A"), // Olive
        };

        var colorIndex = Math.Abs(hash) % colors.Length;
        var (dark, light) = colors[colorIndex];

        return $"background: linear-gradient(to right, #{dark}, #{light}, #{dark});";
    }

    private string GetStatusIcon()
    {
        return Book.Status switch
        {
            BookLoggerApp.Core.Models.ReadingStatus.Planned => "üìã",
            BookLoggerApp.Core.Models.ReadingStatus.Reading => "üìñ",
            BookLoggerApp.Core.Models.ReadingStatus.Completed => "‚úÖ",
            BookLoggerApp.Core.Models.ReadingStatus.Abandoned => "‚ùå",
            _ => ""
        };
    }

    private async Task HandleClick()
    {
        await OnClick.InvokeAsync();
    }

    private async Task HandleDelete()
    {
        await OnDelete.InvokeAsync();
    }
}

